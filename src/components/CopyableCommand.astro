---
interface Props {
  command: string;
  label?: string;
}

const { command, label } = Astro.props;
const id = `cmd-${Math.random().toString(36).slice(2, 9)}`;
---

<div class="relative group">
  {label && <span class="text-text-muted text-sm mb-2 block">{label}</span>}
  <div class="flex items-center bg-background-2 border border-border rounded-lg overflow-hidden">
    <code id={id} class="flex-1 px-4 py-3 font-mono text-sm text-text bg-transparent">
      {command}
    </code>
    <button
      class="px-4 py-3 text-text-muted hover:text-text hover:bg-background-3 transition-colors border-l border-border"
      data-copy-target={id}
      aria-label="Copy to clipboard"
    >
      <svg class="w-5 h-5 copy-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
      </svg>
      <svg class="w-5 h-5 check-icon hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
      </svg>
    </button>
  </div>
</div>

<script>
  document.querySelectorAll('[data-copy-target]').forEach((btn) => {
    btn.addEventListener('click', async () => {
      const targetId = btn.getAttribute('data-copy-target');
      const target = document.getElementById(targetId!);
      if (!target) return;

      const text = target.textContent?.trim() || '';
      await navigator.clipboard.writeText(text);

      const copyIcon = btn.querySelector('.copy-icon');
      const checkIcon = btn.querySelector('.check-icon');

      copyIcon?.classList.add('hidden');
      checkIcon?.classList.remove('hidden');

      setTimeout(() => {
        copyIcon?.classList.remove('hidden');
        checkIcon?.classList.add('hidden');
      }, 2000);
    });
  });
</script>
